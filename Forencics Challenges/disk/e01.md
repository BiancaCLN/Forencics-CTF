# Windows Security Questions  
**Category:** Disk / Registry Forensics  
**File:** `questions.e01`  

---

## üß© Summary
We were given a forensic disk image named **`questions.e01`**, with a hint referencing *‚Äúquestions‚Äù*.  
This indicated the challenge involved **Windows 10/11 local password-reset security questions**, which are stored encrypted in the **SAM** registry hive and require the **SYSTEM** hive for decryption.

**Goal:** Extract the correct registry hives from the image, open them with the appropriate forensic tool, and recover the plaintext security questions and answers ‚Äî all while preserving evidence integrity.

---

## üß∞ Tools Used
- **Autopsy** ‚Äî to open and explore the `.E01` image and export registry hives.  
- **SecurityQuestionsView (NirSoft)** ‚Äî specialized GUI that decrypts and displays Windows security questions/answers using `SAM` + `SYSTEM`.  
- **Registry Explorer (Eric Zimmermann)** ‚Äî optional manual hive inspection and timestamp/context checking.  
- **RegRipper / reglookup / Regipy** ‚Äî optional scripted parsing and searching.  
- `xxd`, `base64`, `strings` ‚Äî for decoding hex/Base64 blobs if encountered.  
- *(Advanced)* DPAPI utilities (`dpapick`, `python-dpapi`, `mimikatz`) ‚Äî only when DPAPI blobs need decryption and required keys/authorization are available.

> ‚ö†Ô∏è **Safety note:** Always work on copies of exported files. Never modify the original evidence image.

---

## üß† Theory

### What is an `.E01` file?
An **E01 (Expert Witness Format)** file is a forensic disk image ‚Äî a bit-for-bit copy of a storage device that preserves deleted data, slack space, and metadata. It supports integrity checks and is commonly used with EnCase, Autopsy, FTK Imager, and sleuthkit utilities.

### What is the SAM file?
**SAM (Security Account Manager)** is a registry hive stored at: C:\Windows\System32\config\SAM


It holds local account records (usernames, SIDs), references to password hashes, and encrypted artifacts such as Windows password-reset/security-question data. Some SAM contents are encrypted with system secrets stored in the **SYSTEM** hive, so you typically need both `SAM` and `SYSTEM` to recover readable values.

---

## üß© What Else Lives in `C:\Windows\System32\config\`?
This folder contains Windows‚Äô core registry hives ‚Äî the foundations of system configuration and security.

| Hive File | Description / Forensic Interest |
|-----------|----------------------------------|
| **SAM** | Local user accounts, password hashes, and encrypted password-reset/security-question data (requires `SYSTEM` to decrypt). |
| **SYSTEM** | System-wide configuration and cryptographic keys (SysKey). Required for decrypting certain SAM/SECURITY entries and DPAPI material. |
| **SOFTWARE** | Installed software info, autostart keys, product data ‚Äî useful for persistence and timeline analysis. |
| **SECURITY** | LSA secrets and security policy artifacts ‚Äî cached credentials, service passwords, trust data. |
| **DEFAULT** | Default user profile template (HKU\.DEFAULT). |
| **COMPONENTS / BBI / ELAM** | Component store/boot/config and anti-malware config (modern Windows artifacts). |
| **RegBack** | Backup hive copies (if present) ‚Äî useful if primary hives are corrupted or tampered with. |

### Additional nearby artifacts
- `C:\Windows\System32\winevt\Logs\` ‚Üí Windows Event Logs (.evtx) ‚Äî login, security, system events.  
- `C:\Windows\Prefetch\` ‚Üí Prefetch files ‚Äî executed programs and approximate run times.  
- `C:\Windows\System32\Tasks\` ‚Üí Scheduled tasks ‚Äî persistence/autostart.  
- `C:\Windows\System32\drivers\etc\hosts` ‚Üí Hosts file ‚Äî domain overrides.  
- `C:\Windows\System32\config\Journal\` ‚Üí REGTRANS-MS transaction logs ‚Äî registry change history and deleted key recovery.

---

## üîê LSA Secrets (SECURITY hive)
The **SECURITY** hive holds **LSA Secrets** such as:
- Cached domain credentials (encrypted)
- Service account passwords
- RDP or other stored secrets
These are typically encrypted and require the `SYSTEM` hive to decrypt. Tools: `secretsdump.py` (Impacket), `mimikatz` (lab/authorized only).

---

## üîé What Is Stored in the Evidence
From `questions.e01`, the relevant artifacts are:
- `C:\Windows\System32\config\SAM` ‚Äî encrypted security questions/answers (SAM).  
- `C:\Windows\System32\config\SYSTEM` ‚Äî system secrets/keys needed to decrypt SAM artifacts.  
- Optional supporting files: `SOFTWARE`, user `NTUSER.DAT`, and DPAPI master key files under `C:\Users\<user>\AppData\Roaming\Microsoft\Protect\{SID}\`.

---

## üß≠ Full Step-by-Step Procedure

### 1) Mount / open the E01 (read-only)
**Autopsy (recommended)**  
1. Create a new case ‚Üí Add data source ‚Üí select `questions.e01`.  
2. Let Autopsy parse the file system (NTFS).  
3. Browse to `C:\Windows\System32\config\`.

**Command-line (alternate)**  
```bash
mkdir /mnt/ewf
ewfmount questions.e01 /mnt/ewf
# attach loop device for the EWF segment, then mount partition read-only
sudo losetup -fP /mnt/ewf/ewf1
sudo mount -o ro /dev/loop0p1 /mnt/image
# or use fls/icat to extract files directly


üîç Can You Always See Security Questions in a Disk Image?

Short answer: No.
They appear only for Windows 10/11 local accounts where the user configured password-reset questions.
	‚Ä¢	üü¢ Local account: usually yes (if configured).
	‚Ä¢	üî¥ Microsoft account or domain account: no ‚Äî those use cloud or domain mechanisms, not local SAM-stored questions.
	‚Ä¢	‚ö™ Disabled by policy / never set: nothing to recover.

They are always encrypted in the SAM hive and require the SYSTEM hive to decrypt.

üîê DPAPI (brief)

Many Windows secrets are protected by DPAPI (Data Protection API). If you encounter DPAPI blobs, decryption requires:
	‚Ä¢	SYSTEM hive (machine key info), and
	‚Ä¢	User master key files (under AppData\Roaming\Microsoft\Protect\{SID}) or the user‚Äôs logon secrets.

Tools for DPAPI: dpapick, python-dpapi, dpapi-extractor, mimikatz (authorized use only).

‚∏ª

‚úÖ Forensic Notes & Best Practices
	‚Ä¢	Always work on copies; keep the original evidence untouched.
	‚Ä¢	Record file paths, hashes, export timestamps, and tool versions for chain-of-custody.
	‚Ä¢	Treat any real answers as sensitive PII ‚Äî redact if publishing.
	‚Ä¢	If SecurityQuestionsView returns nothing, note that absence (it‚Äôs a valid finding and may indicate a Microsoft/domain account or policy).

‚∏ª

üß† Lessons Learned (concise)
	‚Ä¢	SAM + SYSTEM are the keys to local credential artifacts; export both.
	‚Ä¢	SecurityQuestionsView is the easiest tool to read Windows password-reset questions offline.
	‚Ä¢	Not all machines will have these questions: local accounts only, and users must have configured them.
	‚Ä¢	Related artifacts (NTUSER.DAT, event logs, Protect folder) provide context and can be required for DPAPI decryption.
	‚Ä¢	Document everything and handle sensitive data responsibly.


